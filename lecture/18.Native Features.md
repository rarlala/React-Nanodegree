# Navite Features



## Introduction

우리가 아직 하지 않은 한가지는 React Native API를 활용하는 것이다. 해당 내용을 학습해보자.



- `components/Live.js`

```react
import React, { Component } from 'react';
import { View, Text, ActivityIndicator } from 'react-native';

class Live extends Component {
  state = {
    coords: null,
    status: null,
    direction: '',
  };

  render() {
    const { status, coords, direction } = this.state;

    if (status === null) {
      return <ActivityIndicator style={{ marginTop: 30 }} />;
    }

    if (status === 'denied') {
      <View>
        <Text>Denied</Text>
      </View>;
    }

    if (status === 'undetermined') {
      <View>
        <Text>undetermined</Text>
      </View>;
    }

    return (
      <View>
        <Text>Live</Text>
      </View>
    );
  }
}

export default Live;
```

- `App.js`

```react
import Live from './components/Live';

// 해당 부분 아래와 같이 코드 수정
<NavigationContainer>
    <Tabs.Navigator
        initialRouteName="AddEntry"
        screenOptions={({ route }) => ({
            tabBarIcon: () => {
                let icon;
                if (route.name === 'AddEntry') {
                    icon = (
                        <FontAwesome name="plus-square" size={30} color={white} />
                    );
                } else if (route.name === 'History') {
                    icon = (
                        <FontAwesome name="ios-bookmarks" size={30} color={white} />
                    );
                } else if (route.name === 'Live') {
                    icon = (
                        <FontAwesome
                            name="ios-speedometer"
                            size={30}
                            color={white}
                            />
                    );
                }
                return icon;
            },
        })}
        tabBarOptions={{
            activeTintColor: Platform.OS === 'ios' ? purple : white,
                style: {
                    height: 80,
                        backgroundColor: Platform.OS === 'ios' ? white : purple,
                            shadowColor: 'rgba(0, 0, 0, 0.24)',
                                shadowOffset: {
                                    width: 0,
                                        height: 3,
                                },
                                    shadowRadius: 6,
                                        shadowOpacity: 1,
                                },
                                }}
        >
        <Tabs.Screen name="History" component={HistoryStack} />
        <Tabs.Screen name="AddEntry" component={AddEntry} />
        <Tabs.Screen name="Live" component={Live} />
    </Tabs.Navigator>
</NavigationContainer>
```





## Geolocation

우리가 만들고자하는 앱에서 사용자는 현재 속도, 고도 및 방향을 추적할 수 있다. 이를 위해 기기 위치 정보를 구독해야한다. 운 좋게도 Expo는 위치 API(`getCurrentPositionAsync()`)를 제공한다. 



```
import { Location } from 'expo';
```

일반적으로 위치 서비스를 처리 할 때 필요한 두 가지 기능 중 하나가 있습니다. 사용자의 현재 위치를 가져 오거나 사용자의 현재 위치를 보고 업데이트하는 것입니다. Expo의 Location 속성은 `getCurrentPositionAsync` 및 `watchPositionAsync`를 사용하여 이러한 옵션을 모두 제공합니다.

`getCurrentPositionAsync`는 향후 업데이트를 보지 않고 장치의 현재 위치를 가져옵니다. `watchPositionAsync`는 장치의 현재 위치를 가져 오지만 위치 업데이트도 구독합니다. 이렇게하면 해당 장치가 위치를 이동하면 알림을 받습니다.

Expo의 Location 속성을 사용하는 방법에 대한 전체 설명서를 보려면 [Location](https://docs.expo.io/versions/latest/sdk/location.html)을 방문하십시오.



> 💡 Geolocation Tips 💡
>
> 사용자의 권한이 필요한 기능을 다룰 때마다 제대로 작동하려면 표시 될 수 있는 모든 다른 UI 옵션을 고려해야합니다. 예를 들어, 사용자의 위치를 다룰 때 관리해야 할 세 가지 시나리오가 있습니다.
>
> 1. 사용자는 자신의 위치를 볼 수 있는 권한을 부여합니다 (가장 좋은 시나리오). 
> 2. 사용자는 자신의 위치에 대한 권한을 거부하거나 부여하지 않기로 결정합니다. 
> 3. 사용자가 자신의 위치에 대한 액세스 권한을 부여하지 않습니다.
>
> 이상적인 세계에서 사용자는 항상 원하는대로 권한을 부여하지만 항상 그런 것은 아니며 UI 개발자로서 그 순간을 적절히 계획해야합니다.



우선 작업을 하기 전 스타일링부터 적용해주었다.

- `Live.js`

```react
import React, { Component } from 'react';
import {
  View,
  Text,
  ActivityIndicator,
  TouchableOpacity,
  StyleSheet,
} from 'react-native';
import { Foundation } from '@expo/vector-icons';
import { purple, white } from '../utils/colors';

class Live extends Component {
  state = {
    coords: null,
    status: 'granted',
    direction: '',
  };

  askPermission = () => {};

  render() {
    const { status, coords, direction } = this.state;

    if (status === null) {
      return <ActivityIndicator style={{ marginTop: 30 }} />;
    }

    if (status === 'denied') {
      return (
        <View style={styles.center}>
          <Foundation name="alert" size={20}>
            <Text>You denied your location</Text>
          </Foundation>
        </View>
      );
    }

    if (status === 'undetermined') {
      return (
        <View style={styles.center}>
          <Foundation name="alert" size={50} />
          <Text>You need to enable location services for this app</Text>
          <TouchableOpacity onPress={this.askPermission} style={styles.button}>
            <Text style={styles.buttonText}>Enable</Text>
          </TouchableOpacity>
        </View>
      );
    }

    return (
      <View style={styles.container}>
        <View style={styles.directionContainer}>
          <Text style={styles.header}>You're Heading</Text>
          <Text style={styles.direction}>North</Text>
        </View>
        <View style={styles.metricContainer}>
          <View style={styles.metric}>
            <Text style={[styles.header, { color: white }]}>Altitude</Text>
            <Text style={[styles.subHeader, { color: white }]}>{200} feet</Text>
          </View>
          <View style={styles.metric}>
            <Text style={[styles.header, { color: white }]}>Speed</Text>
            <Text style={[styles.subHeader, { color: white }]}>{300} MPH</Text>
          </View>
        </View>
      </View>
    );
  }
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'space-between',
  },
  center: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    marginLeft: 30,
    marginRight: 30,
  },
  button: {
    padding: 10,
    backgroundColor: purple,
    alignSelf: 'center',
    borderRadius: 5,
    margin: 20,
  },
  buttonText: {
    color: white,
    fontSize: 20,
  },
  directionContainer: {
    flex: 1,
    justifyContent: 'center',
  },
  header: {
    fontSize: 35,
    textAlign: 'center',
  },
  direction: {
    color: purple,
    fontSize: 120,
    textAlign: 'center',
  },
  metricContainer: {
    flexDirection: 'row',
    justifyContent: 'space-around',
    backgroundColor: purple,
  },
  metric: {
    flex: 1,
    paddingTop: 15,
    paddingBottom: 15,
    backgroundColor: 'rgba(255, 255, 255, 0.1)',
    marginTop: 20,
    marginBottom: 20,
    marginLeft: 10,
    marginRight: 10,
  },
  subHeader: {
    fontSize: 25,
    textAlign: 'center',
    marginTop: 5,
  },
});

export default Live;
```



이제 사용자에게 권한을 요청하고, Location을 표시하는 작업을 진행해보자.

- `Live.js`

```react
import React, { Component } from 'react';
import {
  View,
  Text,
  ActivityIndicator,
  TouchableOpacity,
  StyleSheet,
} from 'react-native';
import { Foundation } from '@expo/vector-icons';
import { purple, white } from '../utils/colors';

import * as Location from 'expo-location';
import * as Permissions from 'expo-permissions';
import { calculateDirection } from '../utils/helpers';

class Live extends Component {
  state = {
    coords: null,
    status: 'granted',
    direction: '',
  };

  componentDidMount() {
    Permissions.getAsync(Permissions.LOCATION).then(({ status }) => {
      if (status === 'granted') {
        return this.setLocation();
      }

      this.setState(() => ({ status })).catch((error) => {
        console.warn('Error getting Location permission: ', error);
        this.setState(() => ({ status: 'undetermined' }));
      });
    });
  }

  askPermission = () => {};

  setLocation = () => {
    Location.watchPositionAsync(
      {
        enableHighAccuracy: true,
        timeInterval: 1,
        distanceInterval: 1,
      },
      ({ coords }) => {
        const newDirection = calculateDirection(coords.heading);
        const { direction } = this.state;
        this.setState(() => ({
          coords,
          status: 'granted',
          direction: newDirection,
        }));
      }
    );
  };

  render() {
    const { status, coords, direction } = this.state;

    if (status === null) {
      return <ActivityIndicator style={{ marginTop: 30 }} />;
    }

    if (status === 'denied') {
      return (
        <View style={styles.center}>
          <Foundation name="alert" size={20}>
            <Text>You denied your location</Text>
          </Foundation>
        </View>
      );
    }

    if (status === 'undetermined') {
      return (
        <View style={styles.center}>
          <Foundation name="alert" size={50} />
          <Text>You need to enable location services for this app</Text>
          <TouchableOpacity onPress={this.askPermission} style={styles.button}>
            <Text style={styles.buttonText}>Enable</Text>
          </TouchableOpacity>
        </View>
      );
    }

    return (
      <View style={styles.container}>
        <View style={styles.directionContainer}>
          <Text style={styles.header}>You're Heading</Text>
          <Text style={styles.direction}>North</Text>
        </View>
        <View style={styles.metricContainer}>
          <View style={styles.metric}>
            <Text style={[styles.header, { color: white }]}>Altitude</Text>
            <Text style={[styles.subHeader, { color: white }]}>{200} feet</Text>
          </View>
          <View style={styles.metric}>
            <Text style={[styles.header, { color: white }]}>Speed</Text>
            <Text style={[styles.subHeader, { color: white }]}>{300} MPH</Text>
          </View>
        </View>
      </View>
    );
  }
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'space-between',
  },
  center: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    marginLeft: 30,
    marginRight: 30,
  },
  button: {
    padding: 10,
    backgroundColor: purple,
    alignSelf: 'center',
    borderRadius: 5,
    margin: 20,
  },
  buttonText: {
    color: white,
    fontSize: 20,
  },
  directionContainer: {
    flex: 1,
    justifyContent: 'center',
  },
  header: {
    fontSize: 35,
    textAlign: 'center',
  },
  direction: {
    color: purple,
    fontSize: 120,
    textAlign: 'center',
  },
  metricContainer: {
    flexDirection: 'row',
    justifyContent: 'space-around',
    backgroundColor: purple,
  },
  metric: {
    flex: 1,
    paddingTop: 15,
    paddingBottom: 15,
    backgroundColor: 'rgba(255, 255, 255, 0.1)',
    marginTop: 20,
    marginBottom: 20,
    marginLeft: 10,
    marginRight: 10,
  },
  subHeader: {
    fontSize: 25,
    textAlign: 'center',
    marginTop: 5,
  },
});

export default Live;
```



이제 진짜로 사용자에게 권한을 요청하는 방법을 배워보자.

```bash
$ expo install expo-location
$ expo install expo-permissions
```



- `Live.js`

`askPermission()`에 이어 작성해보자.

```react
// 해당 함수를 아래와 같이 작성
componentDidMount () {
    this.askPermission()
}

askPermission = () => {
    Permissions.askAsync(Permissions.LOCATION)
        .then(({ status }) => {
        if (status === 'granted') {
            return this.setLocation();
        }
        this.setState(() => ({ status }));
    })
        .catch((error) =>
               console.warn('error asking Location permission: ', error)
              );
};
```

```react
// 정적 데이터가 아닌 받아온 데이터를 출력하도록 코드 수정
return (
    <View style={styles.container}>
        <View style={styles.directionContainer}>
            <Text style={styles.header}>You're Heading</Text>
            <Text style={styles.direction}>{direction}</Text>
        </View>
        <View style={styles.metricContainer}>
            <View style={styles.metric}>
                <Text style={[styles.header, { color: white }]}>Altitude</Text>
                <Text style={[styles.subHeader, { color: white }]}>
                    {Math.round(coords.altitude * 3.2808)} feet
                </Text>
            </View>
            <View style={styles.metric}>
                <Text style={[styles.header, { color: white }]}>Speed</Text>
                <Text style={[styles.subHeader, { color: white }]}>
                    {(coords.spaeed + 2.2369).toFixed(1)} MPH
                </Text>
            </View>
        </View>
    </View>
);
```

[코드 참고](https://github.com/udacity/reactnd-UdaciFitness-complete/commit/0b092b57b530fd6b2d9e9577dd299351e74df75f)

> 참고: 이 커밋에서 코드에 오류가 발생하면 라이브 상태의 coords 속성의 초기 값을 null이 아닌 값으로 업데이트하십시오.



> Which of the following methods would you use to subscribe to the user's location using Expo? Select all that apply.
>
> - `watchPositionAsync`
>
> 사용자의 위치를 구독하려면 Expo의 `Location.watchPositionAsync` 메서드를 사용하십시오.`watchPositionAsync` 메서드는 두개의 인수, 즉 옵션 개체와 위치가 변경 될 때마다 호출할 콜백을 전달합니다.



### Summary

이 개념에서는 expo의 Location 속성을 사용하여 watchPositionAsync를 사용하여 사용자의 현재 위치를 보는 방법을 보았습니다. 자세한 내용은 공식 문서를 확인하십시오.



## Animations



## Local Notifications



## Handling Photos



## App Store Preparation



## Lesson Summary



## Course Outro