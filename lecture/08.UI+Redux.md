# UI + Redux



## Introduction

이전 강의에서 자체 State Management 라이브러리를 구축하여 응용 프로그램의 state 예측 가능성을 향상시키는 방법을 배웠다. 이 강의에서는 State Management를 가져와서 UI를 추가한다.



## UI

지금까지는 index.js 파일에 모두 작성해왔다.

```react
// Library Code
function createStore (reducer) {

  let state
  let listeners = []

  const getState = () => state

  const subscribe = (listener) => {
    listeners.push(listener)
    return () => {
      listeners = listeners.filter((l) => l !== listener)
    }
  }

  const dispatch = (action) => {
    state = reducer(state, action)
    listeners.forEach((listener) => listener())
  }

  return {
    getState,
    subscribe,
    dispatch,
  }
}

// App Code

const ADD_TODO = 'ADD_TODO'
const REMOVE_TODO = 'REMOVE_TODO'
const TOGGLE_TODO = 'TOGGLE_TODO'
const ADD_GOAL = 'ADD_GOAL'
const REMOVE_GOAL = 'REMOVE_GOAL'

// action creators
function addTodoAction(todo) {
    return {
        type: ADD_TODO,
        todo,
    }
}

function removeTodoAction(id) {
    return {
        type: REMOVE_TODO,
        id,
    }
}

function toggleTodoAction(id) {
    return {
        type: TOGGLE_TODO,
        id,
    }
}

function addGoalAction(goal) {
    return {
        type: ADD_GOAL,
        goal,
    }
}

function removeGoalAction(id) {
    return {
        type: REMOVE_GOAL,
        id,
    }
}

function todos (state = [], action) {
  switch(action.type) {
    case ADD_TODO :
      return state.concat([action.todo])
    case REMOVE_TODO :
      return state.filter((todo) => todo.id !== action.id)
    case TOGGLE_TODO :
      return state.map((todo) => todo.id !== action.id ? todo :
        Object.assign({}, todo, { complete: !todo.complete }))
    default :
      return state
  }
}

function goals (state = [], action) {
  switch(action.type) {
    case ADD_GOAL :
      return state.concat([action.goal])
    case REMOVE_GOAL :
      return state.filter((goal) => goal.id !== action.id)
    default :
      return state
  }
}

function app (state = {}, action) {
  return {
    todos: todos(state.todos, action),
    goals: goals(state.goals, action),
  }
}

const store = createStore(app)

store.subscribe(() => {
  console.log('The new state is: ', store.getState())
})

store.dispatch(addTodoAction({
	id: 0,
    name: 'Walk the dog',
    complete: false,
}))
```



이제 우리가 하고 싶은 것은 애플리케이션에 UI를 추가하는 것이다. 이제 우리가 해야할 일은 index.html을 만든 뒤 위에서 작성한 index.js code를 index.html 내 <script> 태그를 활용해 넣어보자.



index.html

```html
<!-- index.html -->

<!DOCTYPE HTML>

<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>Udacity Todos Goals</title>
  </head>
  <body>
    <script type="text/javascript">
      function createStore(reducer) {
        let state;
        let listeners = [];

        const getState = () => state;

        const subscribe = listener => {
          listeners.push(listener);
          return () => {
            listeners = listeners.filter(l => l !== listener);
          };
        };

        const dispatch = action => {
          state = reducer(state, action);
          listeners.forEach(listener => listener());
        };

        return {
          getState,
          subscribe,
          dispatch
        };
      }

      // App Code

      const ADD_TODO = 'ADD_TODO';
      const REMOVE_TODO = 'REMOVE_TODO';
      const TOGGLE_TODO = 'TOGGLE_TODO';
      const ADD_GOAL = 'ADD_GOAL';
      const REMOVE_GOAL = 'REMOVE_GOAL';

      // action creators
      function addTodoAction(todo) {
        return {
          type: ADD_TODO,
          todo
        };
      }

      function removeTodoAction(id) {
        return {
          type: REMOVE_TODO,
          id
        };
      }

      function toggleTodoAction(id) {
        return {
          type: TOGGLE_TODO,
          id
        };
      }

      function addGoalAction(goal) {
        return {
          type: ADD_GOAL,
          goal
        };
      }

      function removeGoalAction(id) {
        return {
          type: REMOVE_GOAL,
          id
        };
      }

      function todos(state = [], action) {
        switch (action.type) {
          case ADD_TODO:
            return state.concat([action.todo]);
          case REMOVE_TODO:
            return state.filter(todo => todo.id !== action.id);
          case TOGGLE_TODO:
            return state.map(todo =>
              todo.id !== action.id
                ? todo
                : Object.assign({}, todo, { complete: !todo.complete })
            );
          default:
            return state;
        }
      }

      function goals(state = [], action) {
        switch (action.type) {
          case ADD_GOAL:
            return state.concat([action.goal]);
          case REMOVE_GOAL:
            return state.filter(goal => goal.id !== action.id);
          default:
            return state;
        }
      }

      function app(state = {}, action) {
        return {
          todos: todos(state.todos, action),
          goals: goals(state.goals, action)
        };
      }

      const store = createStore(app);

      store.subscribe(() => {
        console.log('The new state is: ', store.getState());
      });

      store.dispatch(
        addTodoAction({
          id: 0,
          name: 'Walk the dog',
          complete: false
        })
      );
    </script>
  </body>
</html>
```



### What We're Going to Build

index.html 파일이 있고 모든 JavaScript 코드가 <script> 태그로 전송되었으므로 사용자 인터페이스에서 추가를 시작하겠습니다. 프로젝트에는 두 가지 상태가 있으므로 두 가지 영역이 필요합니다.



1. Todo list area
2. Goals area

![Screenshot of the Todo List app.](https://video.udacity-data.com/topher/2018/March/5abbeeea_nd019-redux-l2-basic-ui/nd019-redux-l2-basic-ui.jpg)

위 이미지는 최종적으로 만들고자하는 UI이다.



우리는 이미 애플리케이션의 Redux 부분이 작동하고 있지만 지금까지 Redux Store와 상호 작용하기 위해 코드 스니펫을 수동으로 실행했습니다. 브라우저를 사용하여 상점과 상호 작용할 수 있도록 위의 UI를 작성하십시오.



기본적으로 Library Code는 응용 프로그램의 상태를 관리한다. 아래와 같이 body 영역에 아래 코드를 추가한다.

```html
<body>
    <div>
    	<h1>Todo List</h1>
	    <input id='todo' type='text' placeholder='Add Todo' />
    	<button id='todoBtn'>Add Todo</button>
	    <ul id='todos'></ul>
  </div>
  <div>
	    <h1>Goals</h1>
	    <input id='goal' type='text' placeholder='Add Goal' />
    	<button id='goalBtn'>Add Goal</button>
	    <ul id='goals'></ul>
  </div>
    
{...}
</body>
```



### Summary

이 섹션에서는 애플리케이션에 최소한의 UI를 추가했습니다. 하지만 앱의 실제 상태는 전혀 바뀌지 않았습니다.

다음 섹션에서는 UI를 통해 컨텐츠를 입력하면 애플리케이션의 상태가 업데이트되도록 반짝이는 새로운 UI를 상태에 연결합니다.





## UI + State

이제 간단한 UI를 만들었으니, 사용자가 추가할 수 있도록 해보자.



```react
<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>Udacity Todos Goals</title>
  </head>
  <body>
    <div>
      <h1>Todo List</h1>
      <input id="todo" type="text" placeholder="Add Todo" />
      <button id="todoBtn">Add Todo</button>
      <ul id="todos"></ul>
    </div>
    <div>
      <h1>Goals</h1>
      <input id="goal" type="text" placeholder="Add Goal" />
      <button id="goalBtn">Add Goal</button>
      <ul id="goals"></ul>
    </div>

    <script type="text/javascript">
      // 고유한 id 생성을 위한 함수
      function generateId() {
        return (
          Math.random()
            .toString(36)
            .substring(2) + new Date().getTime().toString(36)
        );
      }

      function createStore(reducer) {
        let state;
        let listeners = [];

        const getState = () => state;

        const subscribe = listener => {
          listeners.push(listener);
          return () => {
            listeners = listeners.filter(l => l !== listener);
          };
        };

        const dispatch = action => {
          state = reducer(state, action);
          listeners.forEach(listener => listener());
        };

        return {
          getState,
          subscribe,
          dispatch
        };
      }

      // App Code

      const ADD_TODO = 'ADD_TODO';
      const REMOVE_TODO = 'REMOVE_TODO';
      const TOGGLE_TODO = 'TOGGLE_TODO';
      const ADD_GOAL = 'ADD_GOAL';
      const REMOVE_GOAL = 'REMOVE_GOAL';

      // action creators
      function addTodoAction(todo) {
        return {
          type: ADD_TODO,
          todo
        };
      }

      function removeTodoAction(id) {
        return {
          type: REMOVE_TODO,
          id
        };
      }

      function toggleTodoAction(id) {
        return {
          type: TOGGLE_TODO,
          id
        };
      }

      function addGoalAction(goal) {
        return {
          type: ADD_GOAL,
          goal
        };
      }

      function removeGoalAction(id) {
        return {
          type: REMOVE_GOAL,
          id
        };
      }

      function todos(state = [], action) {
        switch (action.type) {
          case ADD_TODO:
            return state.concat([action.todo]);
          case REMOVE_TODO:
            return state.filter(todo => todo.id !== action.id);
          case TOGGLE_TODO:
            return state.map(todo =>
              todo.id !== action.id
                ? todo
                : Object.assign({}, todo, { complete: !todo.complete })
            );
          default:
            return state;
        }
      }

      function goals(state = [], action) {
        switch (action.type) {
          case ADD_GOAL:
            return state.concat([action.goal]);
          case REMOVE_GOAL:
            return state.filter(goal => goal.id !== action.id);
          default:
            return state;
        }
      }

      function app(state = {}, action) {
        return {
          todos: todos(state.todos, action),
          goals: goals(state.goals, action)
        };
      }

      const store = createStore(app);

      store.subscribe(() => {
        console.log('The new state is: ', store.getState());
      });

      // store.dispatch(
      //   addTodoAction({
      //     id: 0,
      //     name: 'Walk the dog',
      //     complete: false
      //   })
      // );

      function addTodo() {
        const input = document.getElementById('todo');
        const name = input.value;
        input.value = '';

        // action 추가하기
        store.dispatch(
          addTodoAction({
            name,
            complete: false,
            id: generateId()
          })
        );
      }

      function addGoal() {
        const input = document.getElementById('goal')
        const name = input.value
        input.value = ''

        store.dispatch(
          addGoalAction({
            id: generateId(),
            name,
          })
        );
      }

      document.getElementById('todoBtn').addEventListener('click', addTodo)
      document.getElementById('goalBtn').addEventListener('click', addGoal)
    </script>
  </body>
</html>
```



**[코드 진행 내역]**

- state를 update하기 위해 UI에서 작업을 해야한다. 따라서, `store.dispatch()`를 주석처리했다.

- 버튼을 클릭했을 때 호출할 함수를 만들기 위해 `function addTodo()`와 `function addGoal`를 생성했다. 

  - 가장 먼저 입력 필드의 값을 가져오기 위해 해당 요소를 `document.getElementId`를 활용해 가져온다.
  - 다음으로는 `input.value`를 수행하여 입력 필드의 이름 또는 값을 가져온다.
  - 다음으로는 입력한 값을 빈문자열로 초기화시키도록 코드를 작성해준다.
  - 이제 dispatch 코드를 작성한다. action creator인 `addTodoAction`를 호출하고 내부에 아이템에 해당하는 값을 적어준다.

  (고유한 id 값을 자동으로 생성해주기 위해서 상단에 `function generateId()`를 선언해주었다.)

- 버튼을 클릭했을 때 `addEventListener`를 호출해준다.



방금 추가 한 변경 사항으로 인해 Todo 입력 필드가 제출 될 때마다 Todo 항목이 상태에 추가되고 Goal 입력 필드가 제출 될 때마다 상태에 새 목표 항목이 추가됩니다.



이것을 단계로 나눕시다. 먼저, 버튼을 클릭했을 때에 귀를 기울여야합니다. 우리는 이것을 일반 DOM .addEventListener () 메소드로 수행했습니다 :

```react
document.getElementById('todoBtn').addEventListener('click', addTodo)

document.getElementById('goalBtn').addEventListener('click', addGoal)
```



\#todoBtn을 누르면 addTodo를 호출하여 상태에 새 항목을 추가합니다.

```react
function addTodo () {
  const input = document.getElementById('todo')
  const name = input.value
  input.value = ''

  store.dispatch(addTodoAction({
    name,
    complete: false,
    id: generateId()
  }));
}
```

이 메소드는 입력 필드에서 정보를 추출하고 입력 필드를 재설정한 다음 사용자가 입력 필드에 입력한 텍스트로 addTodoAction Action Creator를 디스패치합니다.



따라서 UI를 사용하여 상점의 상태를 변경하고 있지만 이러한 변경 사항은 UI에 새 상태를 시각적으로 반영하게 해봅시다.



### UI에 새 상태를 시각적으로 반영하게 하기

```react
<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>Udacity Todos Goals</title>
  </head>
  <body>
    <div>
      <h1>Todo List</h1>
      <input id="todo" type="text" placeholder="Add Todo" />
      <button id="todoBtn">Add Todo</button>
      <ul id="todos"></ul>
    </div>
    <div>
      <h1>Goals</h1>
      <input id="goal" type="text" placeholder="Add Goal" />
      <button id="goalBtn">Add Goal</button>
      <ul id="goals"></ul>
    </div>

    <script type="text/javascript">
      function generateId() {
        return (
          Math.random()
            .toString(36)
            .substring(2) + new Date().getTime().toString(36)
        );
      }

      function createStore(reducer) {
        let state;
        let listeners = [];

        const getState = () => state;

        const subscribe = listener => {
          listeners.push(listener);
          return () => {
            listeners = listeners.filter(l => l !== listener);
          };
        };

        const dispatch = action => {
          state = reducer(state, action);
          listeners.forEach(listener => listener());
        };

        return {
          getState,
          subscribe,
          dispatch
        };
      }

      // App Code
      const ADD_TODO = 'ADD_TODO';
      const REMOVE_TODO = 'REMOVE_TODO';
      const TOGGLE_TODO = 'TOGGLE_TODO';
      const ADD_GOAL = 'ADD_GOAL';
      const REMOVE_GOAL = 'REMOVE_GOAL';

      // action creators
      function addTodoAction(todo) {
        return {
          type: ADD_TODO,
          todo
        };
      }

      function removeTodoAction(id) {
        return {
          type: REMOVE_TODO,
          id
        };
      }

      function toggleTodoAction(id) {
        return {
          type: TOGGLE_TODO,
          id
        };
      }

      function addGoalAction(goal) {
        return {
          type: ADD_GOAL,
          goal
        };
      }

      function removeGoalAction(id) {
        return {
          type: REMOVE_GOAL,
          id
        };
      }

      function todos(state = [], action) {
        switch (action.type) {
          case ADD_TODO:
            return state.concat([action.todo]);
          case REMOVE_TODO:
            return state.filter(todo => todo.id !== action.id);
          case TOGGLE_TODO:
            return state.map(todo =>
              todo.id !== action.id
                ? todo
                : Object.assign({}, todo, { complete: !todo.complete })
            );
          default:
            return state;
        }
      }

      function goals(state = [], action) {
        switch (action.type) {
          case ADD_GOAL:
            return state.concat([action.goal]);
          case REMOVE_GOAL:
            return state.filter(goal => goal.id !== action.id);
          default:
            return state;
        }
      }

      function app(state = {}, action) {
        return {
          todos: todos(state.todos, action),
          goals: goals(state.goals, action)
        };
      }

      const store = createStore(app);

      store.subscribe(() => {
        // 추가한 영역
        // console.log('The new state is: ', store.getState());
        const { goals, todos } = store.getState();

        document.getElementById('goals').innerHTML = '';
        document.getElementById('todos').innerHTML = '';

        todos.forEach(addTodoToDOM);
        goals.forEach(addGoalToDOM);
      });

      // store.dispatch(
      //   addTodoAction({
      //     id: 0,
      //     name: 'Walk the dog',
      //     complete: false
      //   })
      // );

      // DOM code
      function addTodo() {
        const input = document.getElementById('todo');
        const name = input.value;
        input.value = '';

        store.dispatch(
          addTodoAction({
            name,
            complete: false,
            id: generateId()
          })
        );
      }

      function addGoal() {
        const input = document.getElementById('goal');
        const name = input.value;
        input.value = '';

        store.dispatch(
          addGoalAction({
            id: generateId(),
            name
          })
        );
      }

      document.getElementById('todoBtn').addEventListener('click', addTodo);

      document.getElementById('goalBtn').addEventListener('click', addGoal);

	// 추가한 코드      
      function addTodoToDOM(todo) {
        const node = document.createElement('li');
        const text = document.createTextNode(todo.name);
        node.appendChild(text);

        document.getElementById('todos').appendChild(node);
      }

      function addGoalToDOM(goal) {
        const node = document.createElement('li');
        const text = document.createTextNode(goal.name);
        node.appendChild(text);

        document.getElementById('goals').appendChild(node);
      }
    </script>
  </body>
</html>
```



### Todo 항목 클릭 시 취소선 나타나게하기

```react
function addTodoToDOM(todo) {
        const node = document.createElement('li');
        const text = document.createTextNode(todo.name);
        node.appendChild(text);

    // 취소선 나타내게 하는 코드 추가
        node.style.textDecoration = todo.complete ? 'line-through' : 'none';
        node.addEventListener('click', () => {
          store.dispatch(toggleTodoAction(todo.id));
        });

        document.getElementById('todos').appendChild(node);
}
```



### 제거하기

```react
function createRemoveButton(onClick) {
        const removeBtn = document.createElement('button');
        removeBtn.innerHTML = 'X';
        removeBtn.addEventListener('click', onClick);
        return removeBtn;
}

function addTodoToDOM(todo) {
    const node = document.createElement('li');
    const text = document.createTextNode(todo.name);
    node.appendChild(text);

    const removeBtn = createRemoveButton(() => {
        store.dispatch(removeTodoAction(todo.id));
    });

    node.appendChild(text);
    node.appendChild(removeBtn);
    node.style.textDecoration = todo.complete ? 'line-through' : 'none';
    node.addEventListener('click', () => {
        store.dispatch(toggleTodoAction(todo.id));
    });

    document.getElementById('todos').appendChild(node);
}

function addGoalToDOM(goal) {
    const node = document.createElement('li');
    const text = document.createTextNode(goal.name);
    
    const removeBtn = createRemoveButton(() => {
        store.dispatch(removeGoalAction(goal.id));
    });

    node.appendChild(text);
    node.appendChild(removeBtn);

    document.getElementById('goals').appendChild(node);
}
```





최종 코드

```react
<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>Udacity Todos Goals</title>
  </head>
  <body>
    <div>
      <h1>Todo List</h1>
      <input id="todo" type="text" placeholder="Add Todo" />
      <button id="todoBtn">Add Todo</button>
      <ul id="todos"></ul>
    </div>
    <div>
      <h1>Goals</h1>
      <input id="goal" type="text" placeholder="Add Goal" />
      <button id="goalBtn">Add Goal</button>
      <ul id="goals"></ul>
    </div>

    <script type="text/javascript">
      // 고유한 id 생성을 위한 함수
      function generateId() {
        return (
          Math.random()
            .toString(36)
            .substring(2) + new Date().getTime().toString(36)
        );
      }

      function createStore(reducer) {
        let state;
        let listeners = [];

        const getState = () => state;

        const subscribe = listener => {
          listeners.push(listener);
          return () => {
            listeners = listeners.filter(l => l !== listener);
          };
        };

        const dispatch = action => {
          state = reducer(state, action);
          listeners.forEach(listener => listener());
        };

        return {
          getState,
          subscribe,
          dispatch
        };
      }

      // App Code

      const ADD_TODO = 'ADD_TODO';
      const REMOVE_TODO = 'REMOVE_TODO';
      const TOGGLE_TODO = 'TOGGLE_TODO';
      const ADD_GOAL = 'ADD_GOAL';
      const REMOVE_GOAL = 'REMOVE_GOAL';

      // action creators
      function addTodoAction(todo) {
        return {
          type: ADD_TODO,
          todo
        };
      }

      function removeTodoAction(id) {
        return {
          type: REMOVE_TODO,
          id
        };
      }

      function toggleTodoAction(id) {
        return {
          type: TOGGLE_TODO,
          id
        };
      }

      function addGoalAction(goal) {
        return {
          type: ADD_GOAL,
          goal
        };
      }

      function removeGoalAction(id) {
        return {
          type: REMOVE_GOAL,
          id
        };
      }

      function todos(state = [], action) {
        switch (action.type) {
          case ADD_TODO:
            return state.concat([action.todo]);
          case REMOVE_TODO:
            return state.filter(todo => todo.id !== action.id);
          case TOGGLE_TODO:
            return state.map(todo =>
              todo.id !== action.id
                ? todo
                : Object.assign({}, todo, { complete: !todo.complete })
            );
          default:
            return state;
        }
      }

      function goals(state = [], action) {
        switch (action.type) {
          case ADD_GOAL:
            return state.concat([action.goal]);
          case REMOVE_GOAL:
            return state.filter(goal => goal.id !== action.id);
          default:
            return state;
        }
      }

      function app(state = {}, action) {
        return {
          todos: todos(state.todos, action),
          goals: goals(state.goals, action)
        };
      }

      const store = createStore(app);

      store.subscribe(() => {
        // console.log('The new state is: ', store.getState());
        const { goals, todos } = store.getState();

        document.getElementById('goals').innerHTML = '';
        document.getElementById('todos').innerHTML = '';

        todos.forEach(addTodoToDOM);
        goals.forEach(addGoalToDOM);
      });

      // DOM code
      function addTodo() {
        const input = document.getElementById('todo');
        const name = input.value;
        input.value = '';

        // action 추가하기
        store.dispatch(
          addTodoAction({
            name,
            complete: false,
            id: generateId()
          })
        );
      }

      function addGoal() {
        const input = document.getElementById('goal');
        const name = input.value;
        input.value = '';

        store.dispatch(
          addGoalAction({
            id: generateId(),
            name
          })
        );
      }

      document.getElementById('todoBtn').addEventListener('click', addTodo);

      document.getElementById('goalBtn').addEventListener('click', addGoal);

      function createRemoveButton(onClick) {
        const removeBtn = document.createElement('button');
        removeBtn.innerHTML = 'X';
        removeBtn.addEventListener('click', onClick);
        return removeBtn;
      }

      function addTodoToDOM(todo) {
        const node = document.createElement('li');
        const text = document.createTextNode(todo.name);
        node.appendChild(text);

        const removeBtn = createRemoveButton(() => {
          store.dispatch(removeTodoAction(todo.id));
        });

        node.appendChild(text);
        node.appendChild(removeBtn);
        node.style.textDecoration = todo.complete ? 'line-through' : 'none';
        node.addEventListener('click', () => {
          store.dispatch(toggleTodoAction(todo.id));
        });

        document.getElementById('todos').appendChild(node);
      }

      function addGoalToDOM(goal) {
        const node = document.createElement('li');
        const text = document.createTextNode(goal.name);
        const removeBtn = createRemoveButton(() => {
          store.dispatch(removeGoalAction(goal.id));
        });

        node.appendChild(text);
        node.appendChild(removeBtn);

        document.getElementById('goals').appendChild(node);
      }
    </script>
  </body>
</html>
```



### Summary

이 섹션에서는 functioning state application을 front-end UI에 연결했습니다. 새로운 Todo 항목과 Goal 항목을 state에 추가하는데 사용할 수 있는 form 필드와 버튼을 UI에 추가했습니다. 상태를 업데이트하면 응용 프로그램의 시각적 표현이 상태 객체에 저장된 정보의 표현과 일치하도록 전체 응용 프로그램이 다시 렌더링됩니다.

이제 코드를 모두 직접 작성했습니다. 다음 섹션에서는 커스텀 라이브러리 사용에서 Redux 사용으로 변환합니다.